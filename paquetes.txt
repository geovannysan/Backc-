dotnet add package Microsoft.EntityFrameworkCore.SqlServer --version 7.0.3
dotnet add package Newtonsoft.Json
dotnet add package Microsoft.EntityFrameworkCore.SqlServer

dotnet ef dbcontext scaffold "Server=localhost,1433; Database=Prubatienda; User=sa; Password =mssql1Ipw;TrustServerCertificate=True;" Microsoft.EntityFrameworkCore.SqlServer -o Models
dotnet add package Microsoft.EntityFrameworkCore.Tools --version 7.0.4

dotnet publish /p:Configuration=Release /p:PublishProfile=FolderProfile
DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `Reporte`(IN fecha_inicio DATE, IN fecha_fin DATE)
BEGIN
    SELECT bancoscon.banco, bancoscon.name,   
      ROUND(SUM(bancoscon.monto),2) AS total_compras, 
      CASE WHEN transacion.transacciones IS NOT NULL THEN 'SI' ELSE 'NO' END AS codigo_encontrado ,
      COUNT(bancoscon.codigo) AS Total 
    FROM bancoscon
    INNER JOIN transacion ON bancoscon.codigo = transacion.transacciones
    WHERE bancoscon.fecha >= fecha_inicio AND bancoscon.fecha <= fecha_fin
    GROUP BY bancoscon.name
    UNION
    SELECT 
     bancoscon.banco, 
      bancoscon.name, 
      ROUND( SUM(bancoscon.monto),2) AS total_monto, 
     CASE WHEN bancoscon.codigo IS NOT NULL THEN 'NO' ELSE 'SI' END AS codigo_encontrado ,
     COUNT(bancoscon.codigo) AS Total
    FROM bancoscon
    WHERE NOT EXISTS (
      SELECT *
      FROM transacion
      WHERE bancoscon.codigo = transacion.transacciones
    )
    AND bancoscon.fecha >= fecha_inicio AND bancoscon.fecha <= fecha_fin
    GROUP BY bancoscon.banco, bancoscon.name;
END$$
DELIMITER ;
SELECT SUM(bancoscon.monto) as Total, bancoscon.banco as Banco, bancoscon.name as Cuenta
FROM transacion
INNER JOIN bancoscon
ON transacion.transacciones = bancoscon.codigo
GROUP by bancoscon.banco AND bancoscon.name;
/*create table bancoscon(
 id int  primary key AUTO_INCREMENT,
 fecha  datetime,
 codigo varchar(200) UNIQUE,
 documento varchar(200),
 monto varchar(100),
 oficina varchar(200),
 banco varchar(200),
 name varchar(200)
);*/
CREATE TABLE transacion(
id int PRIMARY KEY AUTO_INCREMENT,
cliente varchar(200),
idtranse varchar(200),
factura varchar(200),
legal varchar(200),
transacciones varchar(200) UNIQUE,
forma_pago varchar(200),
Operador varchar(200),
comision varchar(200),
neto varchar(200),
fecha date,
cobrado double,
cedula varchar(200),    
name varchar(200)
);